<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Crypto CTF â€“ Caribbean Edition Â· Eiland-scoreboard</title>
  <link rel="stylesheet" href="/static/app.css">
</head>
<body>
  <header class="hero" role="banner">
    <h1>Eiland-scoreboard</h1>
    <p>Welke eilandengroep leidt? ğŸï¸</p>
  </header>

  <main class="container">
    <section class="panel" aria-label="Eiland-scoreboard">
      <table class="table">
        <thead>
          <tr>
            <th class="rank">#</th>
            <th>Eiland</th>
            <th>Teams</th>
            <th style="text-align:right">Totale score</th>
          </tr>
        </thead>
        <tbody id="island-scores">
          {% for i, r in enumerate(islands or []) %}
          <tr>
            <td class="rank">{{ i+1 }}</td>
            <td class="island">{{ r.island }}</td>
            <td class="teams">{{ r.teams|default(0) }}</td>
            <td class="score">{{ r.score|default(0) }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </section>

    <div class="ticker-wrap" aria-live="polite" aria-atomic="true">
      <div class="ticker" id="ticker">Laden van live updatesâ€¦</div>
    </div>
  </main>

  <script>
    async function refreshIslands(){
      const tbody = document.getElementById('island-scores');
      try {
        const res = await fetch('/api/scoreboard/islands').catch(()=>null);
        if(!res || !res.ok) return;
        const data = await res.json();
        const list = data.items || data.islands || [];
        tbody.innerHTML = list.map((x, i) => `
          <tr>
            <td class="rank">${i+1}</td>
            <td class="island">${x.island ?? x.name ?? 'â€”'}</td>
            <td class="teams">${x.teams ?? 0}</td>
            <td class="score">${x.score ?? 0}</td>
          </tr>
        `).join("");
      } catch(e){}
    }
    setInterval(refreshIslands, 30000);
    refreshIslands();

    async function fetchTicker(){
      const el = document.getElementById('ticker');
      try {
        const res = await fetch('/api/ticker').catch(()=>null);
        if(!res || !res.ok){ el.textContent = "Nog geen solvesâ€¦ keep hacking! ğŸ’ª"; return; }
        const data = await res.json();
        const text = (data.items && data.items.length)
          ? " ğŸ " + data.items.join("   â€¢   ")
          : "Nog geen solvesâ€¦ keep hacking! ğŸ’ª";
        el.textContent = text;
        el.style.animation = "none"; void el.offsetWidth; el.style.animation = "ticker-scroll 35s linear infinite";
      } catch(e) { el.textContent = "Nog geen solvesâ€¦ keep hacking! ğŸ’ª"; }
    }
    fetchTicker(); setInterval(fetchTicker, 15000);
  </script>
</body>
</html>
